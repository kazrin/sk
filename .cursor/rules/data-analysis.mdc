# データ分析ルール

## データ読み込み
- Excelファイルの読み込みには必ず`@st.cache_data`を使用する
- 欠損データを適切に処理する
- 処理前にデータ構造を検証する
- ヘッダー付きExcelファイルには適切なskiprowsパラメータを使用する

## 類似度計算
- セットベースの比較（届出内容）にはJaccard類似度を使用する
- 類似度は次の式で計算: 積集合 / 和集合
- エッジケースを処理する（空のセット、同一のセット）
- 結果を類似度スコアでソートする（降順）

## データ集計
- 医療機関レベルの集計にはpandasの`groupby()`を使用する
- 適切な集約関数とともに`.agg()`を使用する
- 要約統計を作成する際は元のデータを保持する
- 集計ロジックを明確に文書化する

## テーブル表示
- コンテキストのためにすべての関連カラムを含める
- 最も関連性の高いメトリック（類似度、件数など）でテーブルをソートする
- 数値カラムを適切にフォーマットする（パーセンテージ、件数）
- 有用な場所ではソートとフィルタリングを許可する

## パフォーマンスの考慮事項
- 可能な場合は計算された類似度の結果をキャッシュする
- パフォーマンスの必要に応じて表示結果を制限する
- 効率的なデータ構造を使用する（メンバーシップテストにはセット）
- 大規模な結果セットにはページネーションを考慮する
